<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Email - Firebase</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #10b981;
            text-align: center;
        }

        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        button:hover {
            background: #059669;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .info {
            background: #e0f2fe;
            color: #075985;
            border: 1px solid #0ea5e9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>üß™ Test de Email Firebase</h1>

        <div class="info">
            <strong>üìß Destinatario:</strong> apps@pujaltefotografia.es<br>
            <strong>üî• Proyecto:</strong> asistente-digital-comuniones<br>
            <strong>üìù Colecci√≥n:</strong> mail
        </div>

        <button onclick="sendTestEmail()">üì® Enviar Email de Prueba</button>

        <div id="result"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBsiG9CByzLlrvGgjctJshIrc2k-Ck1DWM",
            authDomain: "asistente-digital-comuniones.firebaseapp.com",
            projectId: "asistente-digital-comuniones",
            storageBucket: "asistente-digital-comuniones.firebasestorage.app",
            messagingSenderId: "318953930173",
            appId: "1:318953930173:web:25bbcbca953e978ffa6d4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.sendTestEmail = async function () {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'info';
            resultDiv.innerHTML = '‚è≥ Enviando email de prueba...';

            try {
                const fechaActual = new Date().toLocaleString('es-ES');

                const docRef = await addDoc(collection(db, 'mail'), {
                    to: ['apps@pujaltefotografia.es'],
                    message: {
                        subject: 'üß™ Test Email - Sistema de Leads',
                        text: 'Este es un email de prueba del sistema de notificaciones.\n\nSi recibes este mensaje, la configuraci√≥n de Firebase Email Extension est√° funcionando correctamente.\n\nFecha: ' + fechaActual,
                        html: `
                            <div style="font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5;">
                                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; margin: 0 auto;">
                                    <h2 style="color: #10b981;">üß™ Email de Prueba</h2>
                                    <p>Este es un email de prueba del sistema de notificaciones.</p>
                                    <p>Si recibes este mensaje, la configuraci√≥n de <strong>Firebase Email Extension</strong> est√° funcionando correctamente.</p>
                                    <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 20px 0;">
                                    <p style="font-size: 12px; color: #6b7280;">
                                        <strong>Fecha:</strong> ${fechaActual}<br>
                                        <strong>Proyecto:</strong> asistente-digital-comuniones
                                    </p>
                                </div>
                            </div>
                        `
                    }
                });

                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    ‚úÖ <strong>Email enviado correctamente</strong><br><br>
                    üìÑ ID del documento: <code>${docRef.id}</code><br><br>
                    <strong>Pr√≥ximos pasos:</strong><br>
                    1. Revisa la bandeja de entrada de <strong>apps@pujaltefotografia.es</strong><br>
                    2. Si no llega en 1-2 minutos, revisa la carpeta de SPAM<br>
                    3. Verifica en Firebase Console ‚Üí Extensions ‚Üí Trigger Email
                `;

                console.log("‚úÖ Email document created with ID:", docRef.id);

            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `
                    ‚ùå <strong>Error al enviar email</strong><br><br>
                    ${error.message}<br><br>
                    <strong>Posibles causas:</strong><br>
                    ‚Ä¢ La extensi√≥n "Trigger Email" no est√° instalada en Firebase<br>
                    ‚Ä¢ Falta configurar el servicio SMTP (SendGrid, Gmail, etc.)<br>
                    ‚Ä¢ Permisos insuficientes en Firestore
                `;
                console.error("‚ùå Error:", error);
            }
        };
    </script>
</body>

</html>